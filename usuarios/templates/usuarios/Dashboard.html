{% load static %}
<!doctype html>
<html lang="es" data-bs-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>El Correo - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Mantengo tu CSS actual por compatibilidad -->
    <link href="{% static 'usuarios/css/deshboard_html.css' %}" rel="stylesheet">
    <link href="{% static 'usuarios/css/Dashboard.css' %}" rel="stylesheet">
    <!-- Estilos mínimos para la interfaz del mock (no rompe rutas) -->

</head>
<body>
    <!-- Topbar -->
    <header class="bg-white border-bottom">
        <div class="container-fluid py-2 d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-light" data-bs-toggle="offcanvas" data-bs-target="#appMenu" aria-controls="appMenu">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="brand-chip"><span class="fw-bold text-white">EC</span></div>
                <div>
                    <div class="fw-semibold">El Correo</div>
                    <div class="text-muted small">Sistema de Gestión de Personal</div>
                </div>
            </div>
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-light position-relative">
                    <i class="fas fa-bell"></i>
                    <span class="badge bg-danger position-absolute translate-middle p-1 rounded-circle" style="top:0.3rem; right:0.3rem;"></span>
                </button>
                {% if request.user.is_staff or request.user.is_superuser %}
                <a href="{% url 'admin:index' %}" class="btn btn-dark">
                    <i class="fas fa-shield-halved me-1"></i> Admin
                </a>
                {% endif %}
            </div>
        </div>
    </header>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="appMenu" aria-labelledby="appMenuLabel" style="--bs-offcanvas-width: 280px;">
        <div class="offcanvas-header">
            <h5 id="appMenuLabel">Menú</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="list-group list-group-flush">
                <a class="list-group-item list-group-item-action" href="{% url 'usuarios:dashboard' %}"><i class="fas fa-gauge me-2"></i> Dashboard</a>
                {% if can_view_trabajadores %}
                <a class="list-group-item list-group-item-action" href="{% url 'usuarios:lista_trabajadores' %}"><i class="fas fa-users me-2"></i> Trabajadores</a>
                {% endif %}
                <a class="list-group-item list-group-item-action" href="{% url 'usuarios:lista_departamentos' %}"><i class="fas fa-building me-2"></i> Departamentos</a>
                <a class="list-group-item list-group-item-action" href="{% url 'usuarios:lista_cargos' %}"><i class="fas fa-briefcase me-2"></i> Cargos</a>
                <a class="list-group-item list-group-item-action" href="{% url 'usuarios:lista_areas' %}"><i class="fas fa-location-dot me-2"></i> Áreas</a>
                {% if can_view_users %}
                <a class="list-group-item list-group-item-action" href="{% url 'usuarios:lista_usuarios' %}"><i class="fas fa-user-group me-2"></i> Usuarios</a>
                {% endif %}
                <a class="list-group-item list-group-item-action" href="{% url 'usuarios:perfil' %}"><i class="fas fa-id-badge me-2"></i> Perfil</a>
                <a class="list-group-item list-group-item-action text-danger" href="{% url 'usuarios:logout' %}"><i class="fas fa-right-from-bracket me-2"></i> Cerrar sesión</a>
            </div>
        </div>
    </div>

    <main class="container my-3">
        <!-- Hero Bienvenida -->
        <section class="hero card border-0 shadow-sm mb-3">
            <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                    <h2 class="h4 mb-1">¡Bienvenido, {{ request.user.get_full_name|default:request.user.username }}!</h2>
                    <div class="text-muted">
                        <i class="fas fa-calendar-day me-1"></i>
                        {% now "l d \d\e F \d\e Y, H:i" %}
                        <span class="ms-2">• Último acceso: Hoy a las 09:30</span>
                    </div>
                </div>
                <div class="hero-icon">
                    <i class="fas fa-signal"></i>
                </div>
            </div>
        </section>

        <!-- KPIs -->
        <section class="row g-3 mb-3">
            <div class="col-sm-6 col-xl-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <div class="text-muted small">TRABAJADORES</div>
                                <div class="display-6 fw-bold" id="count-trabajadores">{{ total_trabajadores }}</div>
                                <div class="text-success small"><i class="fas fa-arrow-up me-1"></i> +12% vs mes anterior</div>
                            </div>
                            <div class="stat-icon bg-primary-subtle text-primary"><i class="fas fa-users"></i></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-xl-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <div class="text-muted small">DEPARTAMENTOS</div>
                                <div class="display-6 fw-bold" id="count-departamentos">{{ total_departamentos }}</div>
                                <div class="text-success small"><i class="fas fa-arrow-up me-1"></i> +5% vs mes anterior</div>
                            </div>
                            <div class="stat-icon bg-success-subtle text-success"><i class="fas fa-building"></i></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-xl-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <div class="text-muted small">CARGOS</div>
                                <div class="display-6 fw-bold">{{ total_cargos }}</div>
                                <div class="text-success small"><i class="fas fa-arrow-up me-1"></i> +8% vs mes anterior</div>
                            </div>
                            <div class="stat-icon bg-warning-subtle text-warning"><i class="fas fa-briefcase"></i></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-xl-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <div class="text-muted small">ÁREAS</div>
                                <div class="display-6 fw-bold" id="count-areas">{{ total_areas }}</div>
                                <div class="text-danger small"><i class="fas fa-arrow-down me-1"></i> -2% vs mes anterior</div>
                            </div>
                            <div class="stat-icon bg-info-subtle text-info"><i class="fas fa-location-dot"></i></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Acciones Rápidas + Actividad Reciente -->
        <section class="row g-3">
            <div class="col-12 col-lg-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white"><strong>Acciones Rápidas</strong></div>
                    <div class="card-body">
                        <div class="row g-3">
                            <!-- Acciones Rápidas -->
                            <div class="row g-3">
                                {% if can_view_trabajadores %}
                                <!-- Ver Trabajadores -->
                                <div class="col-sm-6">
                                    <a class="card h-100 text-decoration-none" href="{% url 'usuarios:lista_trabajadores' %}">
                                        <div class="card-body d-flex align-items-center gap-3">
                                            <div class="quick-icon text-primary bg-primary-subtle"><i class="fas fa-users"></i></div>
                                            <div>
                                                <div class="fw-semibold">Ver Trabajadores</div>
                                                <div class="text-muted small">Ver listado</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                {% endif %}
                                {% if can_create_trabajador %}
                                <div class="col-sm-6">
                                    <a class="card h-100 text-decoration-none" href="{% url 'usuarios:alta_trabajador' %}">
                                        <div class="card-body d-flex align-items-center gap-3">
                                            <div class="quick-icon text-primary bg-primary-subtle"><i class="fas fa-user-plus"></i></div>
                                            <div>
                                                <div class="fw-semibold">Nuevo Trabajador</div>
                                                <div class="text-muted small">Registrar empleado</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                {% endif %}
                                {% if can_manage_catalog %}
                                <div class="col-sm-6">
                                    <a class="card h-100 text-decoration-none" href="{% url 'usuarios:lista_departamentos' %}">
                                        <div class="card-body d-flex align-items-center gap-3">
                                            <div class="quick-icon text-success bg-success-subtle"><i class="fas fa-building"></i></div>
                                            <div>
                                                <div class="fw-semibold">Departamentos</div>
                                                <div class="text-muted small">Administrar</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="col-sm-6">
                                    <a class="card h-100 text-decoration-none" href="{% url 'usuarios:lista_cargos' %}">
                                        <div class="card-body d-flex align-items-center gap-3">
                                            <div class="quick-icon text-warning bg-warning-subtle"><i class="fas fa-briefcase"></i></div>
                                            <div>
                                                <div class="fw-semibold">Cargos</div>
                                                <div class="text-muted small">Administrar</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="col-sm-6">
                                    <a class="card h-100 text-decoration-none" href="{% url 'usuarios:lista_areas' %}">
                                        <div class="card-body d-flex align-items-center gap-3">
                                            <div class="quick-icon text-info bg-info-subtle"><i class="fas fa-location-dot"></i></div>
                                            <div>
                                                <div class="fw-semibold">Áreas</div>
                                                <div class="text-muted small">Administrar</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                {% endif %}
                                {% if can_create_usuario %}
                                <div class="col-sm-6">
                                    <a class="card h-100 text-decoration-none" href="{% url 'usuarios:crear_usuario' %}">
                                        <div class="card-body d-flex align-items-center gap-3">
                                            <div class="quick-icon text-dark bg-dark-subtle"><i class="fas fa-user-gear"></i></div>
                                            <div>
                                                <div class="fw-semibold">Nuevo Usuario</div>
                                                <div class="text-muted small">Crear cuenta</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div> <!-- row -->
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white"><strong>Actividad Reciente</strong></div>
                    <div class="list-group list-group-flush">
                        {% for a in recent_activity %}
                            <div class="list-group-item d-flex align-items-center">
                                <span class="me-3">
                                    {% if a.type == 'create' %}
                                        <i class="fas fa-circle text-success me-1"></i>
                                    {% elif a.type == 'update' %}
                                        <i class="fas fa-circle text-warning me-1"></i>
                                    {% else %}
                                        <i class="fas fa-circle text-danger me-1"></i>
                                    {% endif %}
                                </span>
                                <div class="flex-fill">
                                    <strong>{{ a.action }}</strong>
                                    <div class="text-muted small">por {{ a.user }} • hace {{ a.time }}</div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="list-group-item text-muted">Sin actividad</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="{% static 'usuarios/js/menu.js' %}"></script>
</html>
